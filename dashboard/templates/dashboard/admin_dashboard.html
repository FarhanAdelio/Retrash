{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container-fluid my-4">
    <h2 class="mb-4">
        <i class="fas fa-tachometer-alt"></i> Admin Dashboard
    </h2>
    
    <!-- Statistik Utama -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-start border-primary border-4 shadow h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                                Total Pengguna
                            </div>
                            <div class="h4 mb-0 fw-bold text-gray-800">{{ total_users }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-start border-success border-4 shadow h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-success text-uppercase mb-1">
                                Anggota Aktif
                            </div>
                            <div class="h4 mb-0 fw-bold text-gray-800">{{ pendaftaran_approved }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-check fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-start border-warning border-4 shadow h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                                Pending Verifikasi
                            </div>
                            <div class="h4 mb-0 fw-bold text-gray-800">{{ pendaftaran_pending }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clock fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-start border-info border-4 shadow h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-info text-uppercase mb-1">
                                Bank Sampah
                            </div>
                            <div class="h4 mb-0 fw-bold text-gray-800">{{ total_bank_sampah }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-building fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Statistik Transaksi -->
    <div class="row mb-4">
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card bg-primary text-white shadow">
                <div class="card-body">
                    <div class="text-xs fw-bold text-white text-uppercase mb-1">Total Transaksi</div>
                    <div class="h3 mb-0">{{ total_transaksi }}</div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card bg-warning text-white shadow">
                <div class="card-body">
                    <div class="text-xs fw-bold text-white text-uppercase mb-1">Transaksi Pending</div>
                    <div class="h3 mb-0">{{ transaksi_pending }}</div>
                </div>
            </div>
        </div>
        <div class="col-xl-4 col-md-6 mb-4">
            <div class="card bg-info text-white shadow">
                <div class="card-body">
                    <div class="text-xs fw-bold text-white text-uppercase mb-1">Total Artikel</div>
                    <div class="h3 mb-0">{{ total_artikel }}</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-bolt"></i> Quick Actions</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'manajemen:admin_verifikasi' %}" class="btn btn-warning w-100">
                                <i class="fas fa-user-check"></i> Verifikasi Anggota 
                                {% if pendaftaran_pending > 0 %}
                                    <span class="badge bg-danger">{{ pendaftaran_pending }}</span>
                                {% endif %}
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="/admin/" class="btn btn-secondary w-100" target="_blank">
                                <i class="fas fa-cog"></i> Django Admin
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'manajemen:bank_sampah_list' %}" class="btn btn-primary w-100">
                                <i class="fas fa-building"></i> Kelola Bank Sampah
                            </a>
                        </div>
                        <div class="col-md-3 mb-2">
                            <a href="{% url 'manajemen:artikel_list' %}" class="btn btn-success w-100">
                                <i class="fas fa-newspaper"></i> Kelola Artikel
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Aktivitas Terbaru -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-user-plus"></i> Pendaftaran Terbaru</h5>
                </div>
                <div class="card-body">
                    {% if recent_pendaftaran %}
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Nama</th>
                                        <th>Tanggal</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for p in recent_pendaftaran %}
                                    <tr>
                                        <td>{{ p.nama_lengkap }}</td>
                                        <td>{{ p.tanggal_daftar|date:"d M Y" }}</td>
                                        <td>
                                            {% if p.status == 'pending' %}
                                                <span class="badge bg-warning text-dark">{{ p.get_status_display }}</span>
                                            {% elif p.status == 'approved' %}
                                                <span class="badge bg-success">{{ p.get_status_display }}</span>
                                            {% else %}
                                                <span class="badge bg-danger">{{ p.get_status_display }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted mb-0">Belum ada pendaftaran.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <div class="col-lg-6 mb-4">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-exchange-alt"></i> Transaksi Terbaru</h5>
                </div>
                <div class="card-body">
                    {% if recent_transaksi %}
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>User</th>
                                        <th>Tanggal</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for t in recent_transaksi %}
                                    <tr>
                                        <td>{{ t.user.username }}</td>
                                        <td>{{ t.tanggal_transaksi|date:"d M Y" }}</td>
                                        <td>
                                            {% if t.status == 'pending' %}
                                                <span class="badge bg-secondary">{{ t.get_status_display }}</span>
                                            {% elif t.status == 'diproses' %}
                                                <span class="badge bg-warning text-dark">{{ t.get_status_display }}</span>
                                            {% elif t.status == 'selesai' %}
                                                <span class="badge bg-success">{{ t.get_status_display }}</span>
                                            {% else %}
                                                <span class="badge bg-danger">{{ t.get_status_display }}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted mb-0">Belum ada transaksi.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Pengguna Baru -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="fas fa-users"></i> Pengguna Terbaru</h5>
                </div>
                <div class="card-body">
                    {% if recent_users %}
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Tanggal Bergabung</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for u in recent_users %}
                                    <tr>
                                        <td>{{ u.username }}</td>
                                        <td>{{ u.email }}</td>
                                        <td>{{ u.date_joined|date:"d M Y H:i" }}</td>
                                        <td>
                                            {% if u.is_staff %}
                                                <span class="badge bg-danger">Admin</span>
                                            {% else %}
                                                <span class="badge bg-primary">User</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted mb-0">Belum ada pengguna baru.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
